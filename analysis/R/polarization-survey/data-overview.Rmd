---
title: "Data Overview Analysis"
output:
  pdf_document: default
  html_document: default
---

```{r include = False}
# library(tidyverse)
library(ggplot2)
library(plotly)
library(dplyr)
```

```{r data loadig}
survey_data <- read.csv('../../../backend/data/database/survey_data.csv')
#dim(survey_data)
glimpse(survey_data)
```

```{r treatment groups count}
participants_data <- survey_data %>% distinct(FK_ParticipantId, ParticipantLeaning, TreatmentGroup)
glimpse(participants_data)
```

```{r participant leaning plot}
# Use the Okabe-Ito color-blind-friendly palette
okabe_ito_palette <- c("#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

# Plot with color-blind-friendly colors
participant_leaning = ggplot(leaning_fact, aes(x = ParticipantLeaning, fill = TreatmentGroup)) +
  geom_bar(position = "stack", color = "black", width = 0.5) +
  geom_text(
    aes(label = after_stat(count)),
    stat = "count",
    position = position_stack(vjust = 0.5), # Places the label inside each stacked segment
    size = 3
  ) +
  scale_fill_manual(values = okabe_ito_palette) + # Apply the Okabe-Ito palette
  labs(#title = "Participant Leaning Count by Intervention Group",
       x = "Participant Leaning",
       y = "Count",
       fill = "Intervention") +
  theme_grey() +
  theme(
    plot.title = element_text(size = 18, face = "bold"),  # Title font size and style
    axis.title = element_text(size = 14),               # Axis title font size
    axis.text = element_text(size = 18),                # Axis text font size
    axis.text.x = element_text(angle = 40, hjust = 1),
    legend.title = element_text(size = 18),             # Legend title font size
    legend.text = element_text(size = 16)               # Legend text font size
  )

participant_leaning

ggsave("participant_leaning_count.pdf", 
      plot = participant_leaning,   # Use the last plot created
      device = "pdf",       # Specify PNG format
      width = 10,            # Set width of the PNG (in inches)
      height = 5,           # Set height of the PNG (in inches)
      units = "in",         # Units for width and height
      bg = "white",
      dpi = 300)
```

```{r}
box_plot = ggplot(survey_data, aes(x = TreatmentGroup, y = DiffLikertTreatedOriginal, fill = TreatmentGroup)) +
  geom_boxplot() +
  labs(title = "Boxplot of DiffLikertTreatedOriginal by Treatment Group",
       x = "Treatment Group",
       y = "DiffLikertTreatedOriginal",
       fill = "Intervention") +
  scale_fill_manual(values = c("human" = "#E69F00", "machine" = "#56B4E9", "placebo" = "#009E73")) +  # Optional custom colors
  theme_grey() +
  theme(
    plot.title = element_text(size = 18, face = "bold"),   # Larger title
    axis.title = element_text(size = 14),                  # Larger axis titles
    axis.text = element_text(size = 12),                   # Larger axis labels
    legend.title = element_text(size = 14),                # Larger legend title
    legend.text = element_text(size = 12)                  # Larger legend text
  )
box_plot
```

```{r}
ggsave("boxplot_diff_likert_treated_original.pdf", 
       plot = box_plot,  # Use the last plot created
       device = "pdf",      # Specify PDF format
       width = 8,           # Set width of the PDF (in inches)
       height = 6,          # Set height of the PDF (in inches)
       units = "in",        # Units for width and height
       dpi = 300)
```

```{r}
box_plot2 = ggplot(survey_data, aes(x = TreatmentGroup, y = DiffLikertTreatedOriginal, fill = TreatmentGroup)) +
  geom_violin(alpha = 0.5, width = 1.3, color = "black")+#, draw_quantiles = c(0.25, 0.5, 0.75)) +  # Violin plot with transparency
  geom_boxplot(alpha = 0.6, width = 0.15, color = "black") +  # Boxplot properly aligned to fit inside the violin
  #stat_summary(
   # fun = "median",
    #geom = "point",
    #color = "red"
  #)+
  labs(#title = "DiffLikertTreatedOriginal by Intervention Group",
       x = "Intervention Group",
       y = "DiffTreatedOriginal",
       fill = "Intervention") +
  scale_fill_manual(values = c("human" = "#E69F00", "machine" = "#56B4E9", "placebo" = "#009E73")) +  # Custom color palette
  theme_grey() +
  theme(
    plot.title = element_text(size = 18, face = "bold"),  # Title font size and style
    axis.title = element_text(size = 14),               # Axis title font size
    axis.text = element_text(size = 12),                # Axis text font size
    legend.title = element_text(size = 14),             # Legend title font size
    legend.text = element_text(size = 12)               # Legend text font size
  )
ggsave("boxplot_diff_likert_treated_original-2.pdf", 
       plot = box_plot2,  # Use the last plot created
       device = "pdf",      # Specify PDF format
       width = 8,           # Set width of the PDF (in inches)
       height = 5,          # Set height of the PDF (in inches)
       units = "in",        # Units for width and height
       dpi = 300)
box_plot2

```

```{r}
colors = c("machine_0" = "#C0E4FA",  # Lighter red for machine, TreatedIsLessPolar = 0
           "human_0"   = "#F6C375",  # Medium red for human, TreatedIsLessPolar = 0
           "placebo_0" = "#8AD7BD",  # Darker red for placebo, TreatedIsLessPolar = 0
           "machine_1" = "#56B4E9",  # Lighter green for machine, TreatedIsLessPolar = 1
           "human_1"   = "#E69F00",  # Medium green for human, TreatedIsLessPolar = 1
           "placebo_1" = "#009E73")  # Darker green for placebo, TreatedIsLessPolar = 1

# Create a new variable to combine TreatmentGroup and TreatedIsLessPolar
survey_data$GroupPolar = paste(survey_data$TreatmentGroup, survey_data$TreatedIsLessPolar, sep = "_")

treat_less_polar = ggplot(survey_data, aes(x = TreatmentGroup, fill = GroupPolar)) +
  geom_bar(position = "stack", color = "black", alpha = 0.9, width = 0.6) +
  geom_text(
    aes(
      label = after_stat(count)
    ),
    stat = "count", 
    position = position_stack(vjust = 0.5),  # Center the text inside the bars
    size = 4,  # Text size
    color = "black"  # Black text color for counts
  ) +
  labs(
    #title = "TreatmentIsLessPolar by Treatment Group",
    x = "Treatment Group",
    y = "Count",
    fill = "Treatment is\nLess Polarized"
  ) +
  scale_fill_manual(
    values = colors,  # Use the custom color palette
    labels = c(
      "machine_0" = "Machine (0)", "human_0" = "Human (0)", "placebo_0" = "Placebo (0)",
      "machine_1" = "Machine (1)", "human_1" = "Human (1)", "placebo_1" = "Placebo (1)"
    )
  ) +
  theme_grey() +
  theme(
    plot.title = element_text(size = 18, face = "bold"),  # Larger title font
    axis.title = element_text(size = 14),               # Axis title font
    axis.text = element_text(size = 12),                # Axis text font
    legend.title = element_text(size = 14),             # Legend title font
    legend.text = element_text(size = 12)               # Legend text font
  )

ggsave("treat_less_polar.pdf", 
       plot = treat_less_polar,  # Use the last plot created
       device = "pdf",      # Specify PDF format
       width = 8,           # Set width of the PDF (in inches)
       height = 5,          # Set height of the PDF (in inches)
       units = "in",        # Units for width and height
       dpi = 300)

treat_less_polar
```

```{r}
library(ggplot2)

treat_less_polar = ggplot(survey_data, aes(x = TreatmentGroup, fill = as.factor(TreatedIsLessPolar))) +
  geom_bar(position = "stack", color = "black", alpha = 0.8, width = 0.6) +
  geom_text(
    aes(
      label = after_stat(count)
    ),
    stat = "count", 
    position = position_stack(vjust = 0.5),  # Center the text inside the bars
    size = 4,  # Text size
    color = "black"  # Black text color for counts
  ) +
  labs(
    title = "TreatmentIsLessPolar by Treatment Group",
    x = "Treatment Group",
    y = "Count",
    fill = "Treatment is\nLess Polar"
  ) +
  scale_fill_manual(
    values = c("0" = "#D55E00", "1" = "#009E73"),  # Unified colors for 0 and 1
    labels = c("0", "1")  # Clear legend labels
  ) +
  theme_grey() +
  theme(
    plot.title = element_text(size = 18, face = "bold"),  # Larger title font
    axis.title = element_text(size = 14),               # Axis title font
    axis.text = element_text(size = 12),                # Axis text font
    legend.title = element_text(size = 14),             # Legend title font
    legend.text = element_text(size = 12)               # Legend text font
  )

ggsave("treat_less_polar.pdf", 
       plot = treat_less_polar,  # Use the last plot created
       device = "pdf",      # Specify PDF format
       width = 8,           # Set width of the PDF (in inches)
       height = 5,          # Set height of the PDF (in inches)
       units = "in",        # Units for width and height
       dpi = 300)

treat_less_polar
```

```{r}
# Calculate counts and percentages
summary_data <- survey_data %>%
  group_by(OriginalIsPolarized) %>%
  summarise(
    count = n(),
    percentage = round(count / nrow(survey_data) * 100, 1)
  )

# Print the result
print(summary_data)
```
